{{template "base" .}}

{{define "content"}}
<div class="max-w-4xl mx-auto">
    <!-- Back Button -->
    <div class="mb-4">
        <a href="javascript:history.back()" class="text-blue-600 dark:text-blue-400 hover:underline">
            ‚Üê Back
        </a>
    </div>

    {{if .Paper}}
    <!-- Paper Details -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">
            {{.Paper.Title}}
        </h1>

        <div class="mb-6 space-y-2">
            <p class="text-gray-700 dark:text-gray-300">
                <strong>Authors:</strong> {{.Paper.Authors}}
            </p>
            <p class="text-gray-700 dark:text-gray-300">
                <strong>Published:</strong> {{.Paper.PublishedAt.Format "January 2, 2006"}}
            </p>
            <p class="text-gray-700 dark:text-gray-300">
                <strong>Categories:</strong> {{.Paper.Categories}}
            </p>
            <p class="text-gray-700 dark:text-gray-300">
                <strong>arXiv ID:</strong> {{.Paper.ID}}
            </p>
        </div>

        <!-- Abstract -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">Abstract</h2>
            <p class="text-gray-700 dark:text-gray-300 leading-relaxed">
                {{.Paper.Abstract}}
            </p>
        </div>

        <!-- Links -->
        <div class="mb-6 flex gap-4">
            <a href="{{.Paper.PDFUrl}}" target="_blank" class="btn btn-primary">
                üìÑ Download
            </a>
            <a href="{{.Paper.ArxivUrl}}" target="_blank" class="btn btn-outline">
                üîó View on arXiv
            </a>
        </div>

        <!-- Library Actions -->
        <div class="mb-6 flex gap-4">
            {{if .Paper.InLibrary}}
            <button hx-post="/library/remove/{{.Paper.ID}}" hx-swap="outerHTML" class="btn btn-secondary">
                Remove from Library
            </button>
            <button hx-post="/library/toggle-read/{{.Paper.ID}}" hx-swap="outerHTML"
                class="{{if .Paper.IsRead}}btn btn-sm btn-success{{else}}btn btn-sm btn-outline{{end}}">
                {{if .Paper.IsRead}}‚úì Read{{else}}Mark as Read{{end}}
            </button>
            {{else}}
            <button hx-post="/library/add/{{.Paper.ID}}" hx-swap="outerHTML" class="btn btn-primary">
                Save to Library
            </button>
            {{end}}
        </div>

        <!-- Tags -->
        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">Tags</h2>

            <div id="tags-{{.Paper.ID}}" class="mb-4 flex flex-wrap gap-2">
                {{range .Paper.Tags}}
                <span class="tag">
                    {{.Name}}
                    <button hx-post="/tag/remove" hx-vals='{"paper_id":"{{$.Paper.ID}}","tag_id":{{.ID}}}'
                        hx-target="#tags-{{$.Paper.ID}}" hx-swap="innerHTML" class="tag-remove">
                        √ó
                    </button>
                </span>
                {{else}}
                <span class="text-gray-500 dark:text-gray-400">No tags yet</span>
                {{end}}
            </div>

            <!-- Add Tag Form -->
            <form hx-post="/tag/add" hx-target="#tags-{{.Paper.ID}}" hx-swap="innerHTML" class="flex gap-2">
                <input type="hidden" name="paper_id" value="{{.Paper.ID}}">
                <input type="text" name="tag_name" placeholder="Add a tag..."
                    class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                    required>
                <button type="submit" class="btn btn-primary">
                    Add Tag
                </button>
            </form>
        </div>
    </div>
    {{else}}
    <!-- Paper Not Found -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-12 text-center">
        <p class="text-gray-500 dark:text-gray-400 text-lg mb-4">Paper not found</p>
        <a href="/" class="btn btn-primary">Back to Home</a>
    </div>
    {{end}}
</div>
{{end}}